# 3D Визуализация планировок

## Описание

Модуль 3D визуализации позволяет просматривать план квартиры в трехмерном пространстве с использованием Three.js и React Three Fiber.

## Возможности

### Основные функции

- **Реалистичная 3D модель квартиры** с корректными масштабами
- **Интерактивная камера** с возможностью вращения и масштабирования (OrbitControls)
- **Освещение сцены**:
  - Ambient light (общее освещение)
  - Directional light с тенями
  - Point lights для дополнительного освещения
- **Цветовая кодировка элементов**:
  - Несущие стены — красный цвет
  - Ненесущие перегородки — серый цвет
  - Окна — прозрачный синий
  - Двери — коричневый
  - Комнаты — разные цвета в зависимости от типа

### Элементы визуализации

#### Стены
- Высота потолков: 2.7 метра (стандарт)
- Толщина несущих стен: 150 мм
- Толщина ненесущих стен: 90 мм
- Реалистичные материалы с roughness параметром

#### Окна
- Высота окна: 1.5 метра
- Высота подоконника: 0.9 метра
- Прозрачные материалы для стекла
- Белые рамы

#### Двери
- Высота двери: 2.1 метра
- Ширина: 0.9 метра (стандартная)
- Дверная ручка (золотистая, металлическая)

#### Пол и сетка
- Светло-серый пол
- Сетка с шагом 1 метр для ориентации
- Секции по 5 метров

#### Комнаты
Цветовая маркировка зон на полу:
- Жилая комната (living): зеленый
- Кухня (kitchen): желтый
- Ванная (bathroom): синий
- Туалет (toilet): голубой
- Коридор (corridor): серый
- Балкон (balcony): фиолетовый
- Кладовая (storage): желто-оранжевый

## Технологии

### Библиотеки

```json
{
  "@react-three/fiber": "^8.15.12",
  "@react-three/drei": "^9.92.7",
  "three": "^0.160.0"
}
```

### Компоненты

- **Canvas** - контейнер для 3D сцены
- **PerspectiveCamera** - камера с перспективой
- **OrbitControls** - управление камерой
- **Grid** - сетка координат
- **Mesh** - 3D объекты (стены, двери, окна)

## Использование

### В интерфейсе

1. Создайте план в **редакторе 2D**
2. Перейдите на вкладку **"3D визуализация"**
3. Используйте мышь для навигации:
   - **ЛКМ + движение** - вращение камеры
   - **Колесико мыши** - приближение/отдаление
   - **ПКМ + движение** - панорамирование

### Масштабирование

Система автоматически конвертирует координаты из 2D редактора в 3D:
- 10 пикселей = 1 миллиметр
- 1000 мм = 1 метр
- Масштаб конвертации: 0.001

### Lazy Loading

Компонент 3D визуализации загружается динамически (code splitting) для оптимизации производительности:

```tsx
const FloorPlan3D = React.lazy(() => import('./components/FloorPlan3D'))

// Использование
<Suspense fallback={<LoadingIndicator />}>
  <FloorPlan3D plan={plan} />
</Suspense>
```

## Производительность

### Оптимизации

- Lazy loading компонента 3D
- Shadows только на необходимых объектах
- Оптимизированные геометрии (BoxGeometry, PlaneGeometry)
- Damping для плавного движения камеры

### Требования

- Современный браузер с поддержкой WebGL 2.0
- Рекомендуется GPU с поддержкой аппаратного ускорения

## Расширение функционала

### Будущие улучшения

- Экспорт 3D модели в форматы GLB/GLTF
- Текстурированные материалы для стен и пола
- Мебель и предметы интерьера
- Анимация перехода от "до" к "после" перепланировки
- VR/AR режимы просмотра
- Измерение расстояний в 3D режиме
- Настройка высоты потолков
- Кастомные цвета для элементов

## Пример кода

```tsx
import FloorPlan3D from './components/FloorPlan3D'

function MyComponent() {
  const plan: FloorPlan = {
    walls: [...],
    doors: [...],
    windows: [...],
    rooms: [...],
    hasGasSupply: false,
    floor: 5,
    totalFloors: 9,
    buildingType: 'panel'
  }

  return <FloorPlan3D plan={plan} />
}
```

## Ограничения

- Требуется создание плана в 2D редакторе
- Не поддерживается редактирование в 3D режиме (только просмотр)
- Может быть медленным на старых устройствах
